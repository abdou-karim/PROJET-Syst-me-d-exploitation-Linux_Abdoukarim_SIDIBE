#!/bin/bash
sourcePath=/home/ak-sidibe/Workspace/3_Dev/UNCHK/Syteme_dexploitation/research_library/src/main/shellScript
source $sourcePath/library/HandleDocument.sh
# Définition de la structure de répertoires
DOCUMENTS_DIR="$HOME/Documents/UNCHK_LIBRARY"

# Fonction d'affichage de la bibliothèque
showLibrary() {
    clear
    echo -e "${BLUE}┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐${NC}"
    echo -e "${BLUE}│                                                         ${GREEN}Welcome to our document library${BLUE}                                                              │${NC}"
    echo -e "${BLUE}├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤${NC}"
    files=("$DOCUMENTS_DIR"/*)
    rows=$(((${#files[@]} + 3) / 3))
    for ((i=0; i<rows; i++)); do
        line=""
        for ((j=0; j<3; j++)); do
            index=$(($i + $j * $rows))
            if [ $index -lt ${#files[@]} ]; then
                filename=$(basename "${files[$index]}")

                filename=$(basename "${files[$index]}")
            if [ ${#filename} -gt 40 ]; then
            filename=${filename:0:40}"..."
          fi

            # Utiliser 'fold' pour diviser le nom du fichier en plusieurs lignes si nécessaire
            folded_filename=$(echo "${YELLOW}$((index+1)). ${NC}${filename//_/ }" | fold -w 57 -s)
            line+="$folded_filename"
            # Utiliser 'printf' pour formater l'affichage du nom du fichier
            line+="$(printf "%$((42 - ${#filename}))s" '')"


            else
                line+="$(printf "%84s" '')"
            fi
        done
        echo -e "${BLUE}│${NC} $line"
    done
    echo -e "${BLUE}├────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤${NC}"
    echo -e "${BLUE}│ ${YELLOW}Menu : 1) Add new Document\t│ 2) Import documents \t│ 3) Remove Document\t│ 4) Update Document\t│ 5) Do a search\t│ 6) Sort document by year, subject, category\t│ 7) Exit${NC} │"
    echo -e "${BLUE}└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘${NC}"
    echo
    read -p "$(echo -e "${YELLOW}Please choose an option : ${NC}")" -r choice
    case $choice in
        1) addDocument ;;
        2) addDocumentsFromDirectory ;;
        3) removeDocument ;;
        4) updateDocument ;;
        5) search_files ;;
        6) filter_documents ;;
        7) exit ;;
        *) echo -e "${RED}Invalid choice.${NC}" && sleep 2 && main ;;
    esac
}